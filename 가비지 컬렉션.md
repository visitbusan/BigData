# 가비지 컬렉션 GC

가비지 컬렉션을 사용하는이유
1. 필요없는(사용하지 않는) 메모리를 해제해주지 않으면 memory leak(메모리 누수)이 발생한다.
2. 사용 중이던 메모리를 해제해버리면 프로그램이 중단되고, 데이터가 손실될 수 있다.
메모리 낭비를 최소화하기 위함이다.

하드웨어의 메모리는 제한적이다
따라서 관리를 해주어야 하는데
C나 C++ 같은 저수준의 언어는 malloc(), free()와 같이 메모리를 직접적으로 관리하는 함수들을 사용해 메모리 할당과 해제를 했었다.
현대적인 언어로 오면서 메모리 관리는 점차 사람이 하지 않는 쪽으로 바뀌었다
파이썬에서 이를 해주는 것이 바로 가비지 콜렉터(Garbage Collector)이다


https://dingrr.com/blog/post/python-garbage-collector

https://blog.winterjung.dev/2018/02/18/python-gc#2-%EA%B0%80%EB%B9%84%EC%A7%80-%EC%BB%AC%EB%A0%89%EC%85%98%EC%9D%98-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D

https://wikidocs.net/13969



파이썬의 GC
Cpython에서 주로 사용하는 메모리 관리법은 레퍼런스 카운팅(Reference Counting)이다. 쉽게 말해 우리가 객체를 만들 때 그것이 얼마나 자주 사용되는지 카운트하는 것이다. 생명주기를 카운트 해서 생명주기가 0이되면 메모리에서 삭제한다.

즉, 파이썬은 우리가 객체를 생성해서 사용할 때마다 해당 객체의 reference count를 1씩 증가시키고, 해제할 때 1씩 감소시킨다. 이것이 0이 되면 객체의 메모리 할당이 해제된다.

 

GC와 프로그램의 성능
GC는 프로그램의 성능에 영향을 미친다. 가비지 컬렉션을 수행하려면 프로그램을 완전히 중지해야 한다. 따라서 객체가 많을수록 가비지를 컬렉션하기 위해 더 많은 시간이 필요하다. 가비지 컬렉션 주기가 짧다면 여유 메모리를 확보할 순 있지만 프로그램이 중단되는 상황이 많이 발생한다. 반대로 주기가 길다면 프로그램이 자주 중단되지는 않지만 메모리 공간에 가비지가 많이 쌓이게 된다.


누수예제
https://devloper-dreaming.tistory.com/m/50

메모리 누수가 발생하는 경우 chat GPT
파이썬은 자동으로 메모리를 관리하는 가비지 컬렉션 기능을 갖춘 인터프리터 언어이므로, 일반적으로 메모리 누수가 발생하는 경우는 드뭅니다. 그러나 몇 가지 상황에서 메모리 누수가 발생할 수 있습니다. 여기에 몇 가지 일반적인 상황을 설명하겠습니다:

1. 참조 카운트 문제: 객체가 참조를 가지고 있는 동안 메모리에 유지됩니다. 객체의 참조가 필요 이상으로 지속되면 메모리 누수가 발생할 수 있습니다. 예를 들어, 긴 생명주기를 가진 객체를 불필요하게 참조하거나 순환 참조가 발생하는 경우가 이에 해당합니다. 이런 경우에는 참조를 명시적으로 해제해야 합니다.

2. 큰 데이터 구조: 대량의 데이터를 처리하는 경우, 메모리 사용량이 크게 증가할 수 있습니다. 데이터를 다룰 때 메모리를 효율적으로 관리하고, 사용이 완료되면 메모리에서 해제해야 합니다. 예를 들어, 큰 파일을 처리할 때는 메모리에 전체 파일을 읽어서 저장하는 것이 아니라 조각조각으로 나눠서 처리하는 방식을 고려할 수 있습니다.

3. 외부 자원 누수: 파일, 네트워크 연결, 데이터베이스 연결 등과 같은 외부 리소스를 사용하는 경우, 리소스를 제대로 해제하지 않으면 메모리 누수가 발생할 수 있습니다. 사용한 리소스는 항상 명시적으로 닫고 해제해야 합니다.

4. C 확장 모듈: 파이썬에서 C 또는 C++로 작성된 확장 모듈을 사용하는 경우, 모듈 내에서 메모리 누수가 발생할 수 있습니다. C 모듈을 작성할 때는 메모리 할당과 해제에 주의해야 합니다.

메모리 누수를 방지하려면 코드를 꼼꼼히 검토하고, 참조를 명확하게 관리하며, 사용하지 않는 리소스를 제때 해제하는 등의 조치를 취해야 합니다. 또한, 파이썬의 `gc` 모듈을 사용하여 가비지 컬렉션을 강제로 수행하거나, 메모리 프로파일링 도구를 활용하여 메모리 사용량을 분석할 수도 있습니다.
